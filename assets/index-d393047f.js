var C=Object.defineProperty;var I=(y,c,e)=>c in y?C(y,c,{enumerable:!0,configurable:!0,writable:!0,value:e}):y[c]=e;var p=(y,c,e)=>(I(y,typeof c!="symbol"?c+"":c,e),e);import{P as o}from"./phaser-d7bec1a5.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();class x{static createCharacterSprite(c){if(c.textures.exists("penguin-down"))return;const e=c.add.graphics(),t=64;this.createDirectionalSprite(c,e,"down",t),this.createDirectionalSprite(c,e,"up",t),this.createDirectionalSprite(c,e,"left",t),this.createDirectionalSprite(c,e,"right",t),e.destroy()}static createDirectionalSprite(c,e,t,s){const r=c.add.renderTexture(0,0,s,s);r.setVisible(!1),e.clear();const a=s/2,i=s/2;e.fillStyle(0,.2),e.fillEllipse(a,i+22,25,8),e.fillStyle(2899536,1),e.fillEllipse(a,i+5,32,36),e.fillStyle(16777215,1),e.fillEllipse(a,i+8,22,26),e.fillStyle(1710618,1),t==="left"?(e.fillEllipse(a-18,i+5,12,20),e.fillEllipse(a+12,i+5,8,18)):t==="right"?(e.fillEllipse(a+18,i+5,12,20),e.fillEllipse(a-12,i+5,8,18)):(e.fillEllipse(a-14,i+5,10,18),e.fillEllipse(a+14,i+5,10,18)),e.fillStyle(2899536,1),e.fillCircle(a,i-10,14),e.fillStyle(16777215,1),t==="left"?(e.fillCircle(a-8,i-12,5),e.fillCircle(a-2,i-12,4)):t==="right"?(e.fillCircle(a+8,i-12,5),e.fillCircle(a+2,i-12,4)):t==="up"?(e.fillCircle(a-5,i-14,4),e.fillCircle(a+5,i-14,4)):(e.fillCircle(a-6,i-10,5),e.fillCircle(a+6,i-10,5)),e.fillStyle(0,1),t==="left"?(e.fillCircle(a-9,i-12,3),e.fillCircle(a-3,i-12,2)):t==="right"?(e.fillCircle(a+9,i-12,3),e.fillCircle(a+3,i-12,2)):t==="up"?(e.fillCircle(a-5,i-15,2),e.fillCircle(a+5,i-15,2)):(e.fillCircle(a-6,i-9,3),e.fillCircle(a+6,i-9,3)),e.fillStyle(16753920,1),t==="left"?e.fillTriangle(a-12,i-8,a-6,i-6,a-6,i-10):t==="right"?e.fillTriangle(a+12,i-8,a+6,i-6,a+6,i-10):t==="up"?e.fillTriangle(a,i-18,a-3,i-12,a+3,i-12):e.fillTriangle(a,i-4,a-4,i-8,a+4,i-8),e.fillStyle(16753920,1),e.fillEllipse(a-8,i+22,10,5),e.fillEllipse(a+8,i+22,10,5),r.draw(e),r.saveTexture(`penguin-${t}`),r.destroy()}static createIceTextureGenerated(c){if(c.textures.exists("ice-tile"))return;const e=64,t=c.add.graphics(),s=c.add.renderTexture(0,0,e,e);s.setVisible(!1),t.clear(),t.fillGradientStyle(15792383,14741759,13691135,12640511,1,1,1,1),t.fillRect(0,0,e,e),t.lineStyle(1,12117759,.6);for(let i=0;i<8;i++){const l=o.Math.Between(5,e-5),n=o.Math.Between(5,e-5),d=o.Math.Between(3,8),u=6;t.beginPath();for(let f=0;f<=u;f++){const g=f/u*Math.PI*2,m=l+Math.cos(g)*d,S=n+Math.sin(g)*d;f===0?t.moveTo(m,S):t.lineTo(m,S)}t.strokePath()}t.lineStyle(.5,10344959,.4);for(let i=0;i<5;i++)t.beginPath(),t.moveTo(o.Math.Between(0,e),o.Math.Between(0,e)),t.lineTo(o.Math.Between(0,e),o.Math.Between(0,e)),t.strokePath();t.fillStyle(16777215,.15),t.fillEllipse(e/2,e/4,e*.8,e/6);for(let i=0;i<15;i++){const l=o.Math.Between(0,e),n=o.Math.Between(0,e),d=o.Math.FloatBetween(.05,.15);t.fillStyle(16777215,d),t.fillCircle(l,n,.5)}s.draw(t),s.saveTexture("ice-tile"),s.destroy();const r=c.add.renderTexture(0,0,e,e);r.setVisible(!1),t.clear(),t.fillStyle(11065578,.8),t.fillRect(0,0,e,e),t.lineStyle(2,4886692,.8);for(let i=0;i<8;i++)t.beginPath(),t.moveTo(o.Math.Between(0,e),o.Math.Between(0,e)),t.lineTo(o.Math.Between(0,e),o.Math.Between(0,e)),t.lineTo(o.Math.Between(0,e),o.Math.Between(0,e)),t.strokePath();for(let i=0;i<4;i++){const l=o.Math.Between(0,e),n=o.Math.Between(0,e);t.fillStyle(1981066,.4),t.fillCircle(l,n,o.Math.Between(3,8))}r.draw(t),r.saveTexture("ice-tile-broken"),r.destroy();const a=c.add.renderTexture(0,0,e,e);a.setVisible(!1),t.clear(),t.fillStyle(6174129,.9),t.fillRect(0,0,e,e),t.lineStyle(1,4532128,.5);for(let i=0;i<e;i+=8)for(let l=0;l<e;l+=8)Math.random()>.5&&t.strokeRect(l,i,8,8);t.fillStyle(8280002,.3),t.fillEllipse(e/2,e/3,e*.8,e*.3),a.draw(t),a.saveTexture("safe-path-tile"),a.destroy(),t.destroy()}static createIceTexture(c){this.createIceTextureGenerated(c)}}class P extends o.Scene{constructor(){super({key:"Preloader"})}preload(){}create(){x.createCharacterSprite(this),x.createIceTextureGenerated(this),this.scene.start("MainMenu")}}const h={TILE_SIZE:64,INITIAL_GRID_SIZE:5,MAX_GRID_SIZE:10,PATH_REVEAL_TIME:3e3,PLAYER_MOVE_DURATION:200,JUMP_DISTANCE:1,COLORS:{ICE:14938877,ICE_BORDER:9489145,SAFE_PATH:6174129,SAFE_PATH_GLOW:8280002,PLAYER:16739179,BROKEN_ICE:12312315,PARTICLE:16777215,BACKGROUND_TOP:870305,BACKGROUND_BOTTOM:6600182},DIFFICULTY:{LEVEL_INCREMENT:1,TIME_DECREASE_PER_LEVEL:200,MIN_REVEAL_TIME:1e3},PARTICLES:{SNOW_COUNT:200,SNOW_SPEED:{min:20,max:60},ICE_SHARD_COUNT:12,SPARKLE_COUNT:8}};class M extends o.Scene{constructor(){super({key:"MainMenu"});p(this,"snowParticles",[])}create(){const{width:e,height:t}=this.cameras.main;this.createBackground(),this.createSnowEffect(),this.add.text(e/2,t/3+20,"❄ ICE PATH ❄",{fontSize:"64px",color:"#ffffff",fontStyle:"bold",stroke:"#0D47A1",strokeThickness:6,shadow:{offsetX:0,offsetY:4,color:"rgba(13, 71, 161, 0.5)",blur:10,fill:!0}}).setOrigin(.5),this.add.text(e/2,t/3+85,"크리스탈 기억력 퍼즐",{fontSize:"24px",color:"#E1F5FE",fontStyle:"italic"}).setOrigin(.5);const a=this.add.graphics(),i=e/2,l=t/2+50,n=240,d=70,u=(T,E=1)=>{a.clear(),a.fillStyle(T,E),a.fillRoundedRect(i-n/2,l-d/2,n,d,15),a.lineStyle(2,16777215,.8),a.strokeRoundedRect(i-n/2,l-d/2,n,d,15)};u(4367861);const f=this.add.zone(i,l,n,d);f.setInteractive({useHandCursor:!0});const g=this.add.text(i,l,"게임 시작",{fontSize:"32px",color:"#ffffff",fontStyle:"bold"});g.setOrigin(.5),f.on("pointerover",()=>{u(6600182),this.tweens.add({targets:g,scale:1.1,duration:100})}),f.on("pointerout",()=>{u(4367861),this.tweens.add({targets:g,scale:1,duration:100})}),f.on("pointerdown",()=>{this.cameras.main.fadeOut(500,255,255,255),this.time.delayedCall(500,()=>{this.scene.start("GamePlay",{level:1,score:0})})});const m=localStorage.getItem("icePathHighScore")||"0",S=this.add.text(e/2,t-100,`💎 최고 점수: ${m}`,{fontSize:"24px",color:"#FFE082",stroke:"#0D47A1",strokeThickness:3});S.setOrigin(.5),this.time.addEvent({delay:3e3,callback:()=>{this.createSparkle(S.x-50,S.y),this.createSparkle(S.x+50,S.y)},loop:!0})}createBackground(){const{width:e,height:t}=this.cameras.main;for(let s=0;s<10;s++){const r=t/10*s,a=o.Display.Color.Interpolate.ColorWithColor(o.Display.Color.ValueToColor(h.COLORS.BACKGROUND_TOP),o.Display.Color.ValueToColor(h.COLORS.BACKGROUND_BOTTOM),10,s);this.add.rectangle(e/2,r+t/20,e,t/10,o.Display.Color.GetColor(a.r,a.g,a.b)).setDepth(-10)}}createSnowEffect(){const{width:e,height:t}=this.cameras.main;for(let s=0;s<h.PARTICLES.SNOW_COUNT;s++){const r=o.Math.Between(0,e),a=o.Math.Between(-t,t),i=o.Math.Between(2,6),l=o.Math.Between(h.PARTICLES.SNOW_SPEED.min,h.PARTICLES.SNOW_SPEED.max),n=this.add.rectangle(r,a,i,i,16777215,.8);n.setDepth(-5),this.tweens.add({targets:n,y:t+10,x:r+o.Math.Between(-50,50),duration:(t-a)*(100/l),repeat:-1,delay:o.Math.Between(0,5e3),onRepeat:()=>{n.x=o.Math.Between(0,e),n.y=-10}}),i>4&&this.tweens.add({targets:n,angle:360,duration:o.Math.Between(3e3,6e3),repeat:-1}),this.snowParticles.push(n)}}createSparkle(e,t){const s=this.add.star(e,t,4,3,8,16777215);s.setAlpha(0),this.tweens.add({targets:s,alpha:1,scaleX:1.5,scaleY:1.5,angle:180,duration:500,yoyo:!0,onComplete:()=>{s.destroy()}})}}class B extends o.Scene{constructor(){super({key:"GamePlay"});p(this,"grid",[]);p(this,"player");p(this,"playerState");p(this,"gameState");p(this,"cursors");p(this,"spaceKey");p(this,"path",[]);p(this,"startPos");p(this,"endPos");p(this,"scoreText");p(this,"isPathRevealed",!0);p(this,"snowParticles",[]);p(this,"timerBar");p(this,"pathRevealTimer");p(this,"skipText")}init(e){this.isPathRevealed=!0,this.pathRevealTimer=void 0,this.gameState={level:e.level||1,score:e.score||0,lives:3,currentGridSize:Math.min(h.INITIAL_GRID_SIZE+Math.floor((e.level-1)/2),h.MAX_GRID_SIZE),pathRevealTime:Math.max(h.PATH_REVEAL_TIME-(e.level-1)*h.DIFFICULTY.TIME_DECREASE_PER_LEVEL,h.DIFFICULTY.MIN_REVEAL_TIME)}}preload(){}create(){const{width:e,height:t}=this.cameras.main;this.cameras.main.fadeIn(500,255,255,255),this.createBackground(),this.createSnowEffect(),this.createUI(),this.cursors=this.input.keyboard.createCursorKeys(),this.spaceKey=this.input.keyboard.addKey(o.Input.Keyboard.KeyCodes.SPACE),this.generateGrid(),this.generatePath(),this.createPlayer(),this.revealPath(),this.skipText=this.add.text(e/2,t-50,"스페이스바: 바로 시작",{fontSize:"20px",color:"#FFE082",stroke:"#0D47A1",strokeThickness:3}),this.skipText.setOrigin(.5),this.skipText.setDepth(100),this.tweens.add({targets:this.skipText,alpha:.5,duration:500,yoyo:!0,repeat:-1}),this.pathRevealTimer=this.time.delayedCall(this.gameState.pathRevealTime,()=>{this.startGame()})}skipPathReveal(){this.pathRevealTimer&&this.pathRevealTimer.remove(),this.timerBar&&(this.tweens.killTweensOf(this.timerBar),this.timerBar.setVisible(!1)),this.startGame()}startGame(){this.hidePath(),this.isPathRevealed=!1,this.playerState.canMove=!0,this.skipText&&this.skipText.setVisible(!1);const e=this.add.text(this.cameras.main.width/2,this.cameras.main.height/2,"시작!",{fontSize:"48px",color:"#64B5F6",stroke:"#0D47A1",strokeThickness:6});e.setOrigin(.5),e.setDepth(100),this.tweens.add({targets:e,alpha:0,scale:1.5,duration:500,onComplete:()=>{e.destroy()}})}createBackground(){const{width:e,height:t}=this.cameras.main;for(let s=0;s<10;s++){const r=t/10*s,a=o.Display.Color.Interpolate.ColorWithColor(o.Display.Color.ValueToColor(h.COLORS.BACKGROUND_TOP),o.Display.Color.ValueToColor(h.COLORS.BACKGROUND_BOTTOM),10,s);this.add.rectangle(e/2,r+t/20,e,t/10,o.Display.Color.GetColor(a.r,a.g,a.b)).setDepth(-20)}}createSnowEffect(){const{width:e,height:t}=this.cameras.main;for(let s=0;s<50;s++){const r=o.Math.Between(0,e),a=o.Math.Between(-t,t),i=o.Math.Between(1,3),l=o.Math.Between(20,40),n=this.add.rectangle(r,a,i,i,16777215,.6);n.setDepth(-10),this.tweens.add({targets:n,y:t+10,x:r+o.Math.Between(-30,30),duration:(t-a)*(100/l),repeat:-1,onRepeat:()=>{n.x=o.Math.Between(0,e),n.y=-10}}),this.snowParticles.push(n)}}createUI(){const{width:e}=this.cameras.main;this.add.text(30,30,`❄ 레벨 ${this.gameState.level}`,{fontSize:"28px",color:"#ffffff",stroke:"#0D47A1",strokeThickness:4,shadow:{offsetX:2,offsetY:2,color:"rgba(13, 71, 161, 0.3)",blur:4,fill:!0}}),this.scoreText=this.add.text(30,70,`💎 점수: ${this.gameState.score}`,{fontSize:"24px",color:"#FFE082",stroke:"#0D47A1",strokeThickness:3}),this.add.rectangle(e/2,30,200,20,0,.3).setStrokeStyle(2,16777215,.5),this.timerBar=this.add.rectangle(e/2,30,196,16,6600182),this.tweens.add({targets:this.timerBar,scaleX:0,duration:this.gameState.pathRevealTime,ease:"Linear"})}generateGrid(){const{width:e,height:t}=this.cameras.main,s=this.gameState.currentGridSize,r=(e-s*h.TILE_SIZE)/2,a=(t-s*h.TILE_SIZE)/2+20;this.grid=[];for(let i=0;i<s;i++){this.grid[i]=[];for(let l=0;l<s;l++){const n=r+l*h.TILE_SIZE+h.TILE_SIZE/2,d=a+i*h.TILE_SIZE+h.TILE_SIZE/2,u=this.add.image(n,d,"ice-tile");u.setDisplaySize(h.TILE_SIZE-4,h.TILE_SIZE-4),this.grid[i][l]={position:{x:l,y:i},sprite:u,isPath:!1,isRevealed:!1,isBroken:!1},Math.random()>.7&&this.time.delayedCall(o.Math.Between(0,3e3),()=>{this.grid[i][l].isBroken||this.createTileShimmer(n,d)})}}}generatePath(){const e=this.gameState.currentGridSize;this.startPos={x:0,y:Math.floor(e/2)},this.endPos={x:e-1,y:Math.floor(e/2)},this.path=[];const t=new Set,s=[this.startPos];for(t.add(`${this.startPos.x},${this.startPos.y}`);s.length>0;){const r=s[s.length-1];if(this.path.push(r),r.x===this.endPos.x&&r.y===this.endPos.y)break;const a=this.getValidNeighbors(r,t,e);if(a.length>0){const i=o.Math.RND.pick(a);t.add(`${i.x},${i.y}`),s.push(i)}else s.pop(),this.path.pop()}this.path.forEach(r=>{this.grid[r.y][r.x].isPath=!0})}getValidNeighbors(e,t,s){const r=[],a=[{x:0,y:-1},{x:1,y:0},{x:0,y:1},{x:-1,y:0}];for(const i of a){const l=e.x+i.x,n=e.y+i.y;if(l>=0&&l<s&&n>=0&&n<s){const d=`${l},${n}`;if(!t.has(d)){if(l===this.endPos.x&&n===this.endPos.y)return[{x:l,y:n}];r.push({x:l,y:n})}}}return r}createPlayer(){const e=this.grid[this.startPos.y][this.startPos.x];if(this.textures.exists("penguin-down"))try{this.player=this.add.image(e.sprite.x,e.sprite.y,"penguin-down"),this.player.setDisplaySize(h.TILE_SIZE*.8,h.TILE_SIZE*.8),this.player.setOrigin(.5,.5),this.player.setDepth(10)}catch{this.player=this.add.circle(e.sprite.x,e.sprite.y,h.TILE_SIZE*.3,65280),this.player.setDepth(10)}else this.player=this.add.rectangle(e.sprite.x,e.sprite.y,h.TILE_SIZE*.6,h.TILE_SIZE*.6,16711680),this.player.setDepth(10);this.playerState={gridPosition:{...this.startPos},isMoving:!1,isJumping:!1,canMove:!1,facing:"down"},this.tweens.add({targets:this.player,scaleY:1.05,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.inOut"})}revealPath(){this.path.forEach(s=>{const r=this.grid[s.y][s.x];r.sprite&&(r.sprite.setTexture("safe-path-tile"),r.isRevealed=!0,this.tweens.add({targets:r.sprite,alpha:.7,duration:500,yoyo:!0,repeat:2}))});const e=this.grid[this.startPos.y][this.startPos.x].sprite,t=this.grid[this.endPos.y][this.endPos.x].sprite;if(e){const s=this.add.text(e.x,e.y,"🏁",{fontSize:"32px"});s.setOrigin(.5),s.setDepth(5),this.time.delayedCall(this.gameState.pathRevealTime,()=>{s.destroy()})}if(t){const s=this.add.text(t.x,t.y,"🏆",{fontSize:"32px"});s.setOrigin(.5),s.setDepth(5)}}hidePath(){this.grid.forEach(e=>{e.forEach(t=>{t.sprite&&!t.isBroken&&(t.sprite.setTexture("ice-tile"),t.isRevealed=!1)})})}createTileShimmer(e,t){const s=this.add.rectangle(e,t,h.TILE_SIZE-20,h.TILE_SIZE-20,16777215,0);s.setDepth(1),this.tweens.add({targets:s,alpha:.3,duration:300,yoyo:!0,onComplete:()=>{s.destroy()}})}update(){if(this.isPathRevealed&&!this.playerState.canMove&&o.Input.Keyboard.JustDown(this.spaceKey)){this.skipPathReveal();return}if(!this.playerState.canMove||this.playerState.isMoving)return;let e=0,t=0,s=!1;if(o.Input.Keyboard.JustDown(this.cursors.left)?(e=-1,this.playerState.facing="left",this.player.setTexture(`penguin-${this.playerState.facing}`)):o.Input.Keyboard.JustDown(this.cursors.right)?(e=1,this.playerState.facing="right",this.player.setTexture(`penguin-${this.playerState.facing}`)):o.Input.Keyboard.JustDown(this.cursors.up)?(t=-1,this.playerState.facing="up",this.player.setTexture(`penguin-${this.playerState.facing}`)):o.Input.Keyboard.JustDown(this.cursors.down)&&(t=1,this.playerState.facing="down",this.player.setTexture(`penguin-${this.playerState.facing}`)),o.Input.Keyboard.JustDown(this.spaceKey)&&(e!==0||t!==0)&&(s=!0),e!==0||t!==0){const r=s?2:1;this.movePlayer(e*r,t*r,s)}}movePlayer(e,t,s){const r=this.playerState.gridPosition.x+e,a=this.playerState.gridPosition.y+t,i=this.gameState.currentGridSize;if(r<0||r>=i||a<0||a>=i)return;const l=this.grid[a][r];if(l.isBroken)return;this.playerState.isMoving=!0,this.playerState.isJumping=s;const n=s?-40:0;this.tweens.add({targets:this.player,x:l.sprite.x,y:l.sprite.y+n,duration:h.PLAYER_MOVE_DURATION/2,ease:"Power2",onComplete:()=>{s?this.tweens.add({targets:this.player,y:l.sprite.y,duration:h.PLAYER_MOVE_DURATION/2,ease:"Bounce.out",onComplete:()=>{this.onPlayerLand(r,a)}}):this.onPlayerLand(r,a)}}),this.playerState.gridPosition={x:r,y:a}}onPlayerLand(e,t){const s=this.grid[t][e];s.isPath?(this.playerState.isMoving=!1,this.playerState.isJumping=!1,this.player.setTexture(`penguin-${this.playerState.facing}`),this.createLandingEffect(s.sprite.x,s.sprite.y),e===this.endPos.x&&t===this.endPos.y&&this.levelComplete()):(this.breakIce(s),this.playerFall())}createLandingEffect(e,t){for(let s=0;s<4;s++){const r=this.add.circle(e+o.Math.Between(-10,10),t+20,2,16777215,.8);this.tweens.add({targets:r,x:r.x+o.Math.Between(-20,20),y:r.y+o.Math.Between(-10,-30),alpha:0,duration:400,ease:"Power2",onComplete:()=>{r.destroy()}})}}breakIce(e){if(e.sprite){const t=e.sprite;e.isBroken=!0,t.setTexture("ice-tile-broken"),this.tweens.add({targets:t,alpha:.3,scaleX:.8,scaleY:.8,duration:300,ease:"Power2"});for(let s=0;s<h.PARTICLES.ICE_SHARD_COUNT;s++){const r=this.add.polygon(t.x+o.Math.Between(-20,20),t.y+o.Math.Between(-20,20),[0,0,8,0,4,12],h.COLORS.BROKEN_ICE);r.setStrokeStyle(1,16777215,.5),this.tweens.add({targets:r,x:r.x+o.Math.Between(-60,60),y:r.y+o.Math.Between(40,100),alpha:0,angle:o.Math.Between(180,540),duration:600,ease:"Power2",onComplete:()=>{r.destroy()}})}for(let s=0;s<h.PARTICLES.SPARKLE_COUNT;s++)this.time.delayedCall(s*50,()=>{const r=this.add.star(t.x+o.Math.Between(-30,30),t.y+o.Math.Between(-30,30),4,2,6,16777215);r.setAlpha(.8),this.tweens.add({targets:r,alpha:0,scaleX:0,scaleY:0,duration:400,ease:"Power2",onComplete:()=>{r.destroy()}})})}}playerFall(){this.playerState.canMove=!1,this.tweens.add({targets:this.player,y:this.player.y+300,alpha:0,angle:720,scaleX:0,scaleY:0,duration:1200,ease:"Power2",onComplete:()=>{this.cameras.main.shake(200,.01),this.gameOver()}})}levelComplete(){this.playerState.canMove=!1,this.gameState.score+=100*this.gameState.level,this.scoreText.setText(`💎 점수: ${this.gameState.score}`);const e=this.add.text(this.cameras.main.width/2,this.cameras.main.height/2,"✨ 레벨 완료! ✨",{fontSize:"56px",color:"#FFD700",stroke:"#0D47A1",strokeThickness:8,shadow:{offsetX:0,offsetY:4,color:"rgba(13, 71, 161, 0.5)",blur:10,fill:!0}});e.setOrigin(.5),e.setDepth(100);for(let t=0;t<8;t++)this.time.delayedCall(t*80,()=>{this.createFirework(o.Math.Between(100,this.cameras.main.width-100),o.Math.Between(100,this.cameras.main.height-100))});this.tweens.add({targets:e,scaleX:1.2,scaleY:1.2,angle:10,duration:300,yoyo:!0,repeat:1,ease:"Bounce.out"}),this.time.delayedCall(1500,()=>{this.cameras.main.fadeOut(300,255,255,255),this.time.delayedCall(300,()=>{this.scene.restart({level:this.gameState.level+1,score:this.gameState.score})})})}createFirework(e,t){const s=[16766720,16739179,6600182,16769154,11771355],r=o.Math.RND.pick(s);for(let a=0;a<12;a++){const i=a/12*Math.PI*2,l=this.add.star(e,t,5,3,10,r);l.setDepth(90),this.tweens.add({targets:l,x:e+Math.cos(i)*80,y:t+Math.sin(i)*80,alpha:0,scaleX:0,scaleY:0,duration:800,ease:"Power2",onComplete:()=>{l.destroy()}})}}gameOver(){const e=parseInt(localStorage.getItem("icePathHighScore")||"0");this.gameState.score>e&&localStorage.setItem("icePathHighScore",this.gameState.score.toString()),this.scene.start("GameOver",{score:this.gameState.score,level:this.gameState.level})}}class O extends o.Scene{constructor(){super({key:"GameOver"});p(this,"snowParticles",[])}create(e){const{width:t,height:s}=this.cameras.main;this.cameras.main.fadeIn(500,255,255,255),this.createBackground(),this.createSnowEffect();const r=this.add.text(t/2,s/3-50,"❄ GAME OVER ❄",{fontSize:"64px",color:"#87CEEB",fontStyle:"bold",stroke:"#0D47A1",strokeThickness:8,shadow:{offsetX:0,offsetY:4,color:"rgba(13, 71, 161, 0.5)",blur:10,fill:!0}});r.setOrigin(.5),this.tweens.add({targets:r,scaleX:1.02,scaleY:1.02,duration:3e3,yoyo:!0,repeat:-1,ease:"Sine.inOut"}),this.add.text(t/2,s/2-60,`💎 최종 점수: ${e.score}`,{fontSize:"36px",color:"#FFE082",stroke:"#0D47A1",strokeThickness:4}).setOrigin(.5),this.add.text(t/2,s/2-10,`도달 레벨: ${e.level}`,{fontSize:"28px",color:"#E1F5FE"}).setOrigin(.5);const l=parseInt(localStorage.getItem("icePathHighScore")||"0");if(e.score>=l&&e.score>0){const f=this.add.text(t/2,s/2+40,"🏆 새로운 최고 기록! 🏆",{fontSize:"32px",color:"#FFD700",stroke:"#0D47A1",strokeThickness:4});f.setOrigin(.5),this.tweens.add({targets:f,scaleX:1.2,scaleY:1.2,angle:5,duration:500,yoyo:!0,repeat:-1,ease:"Power2"}),this.time.addEvent({delay:1e3,callback:()=>{this.createSparkleCircle(f.x,f.y,100)},loop:!0})}else this.add.text(t/2,s/2+40,`최고 점수: ${l}`,{fontSize:"24px",color:"#FFE082"}).setOrigin(.5);const n=s/2+140;this.createIceButton(t/2-120,n,"다시 하기",4367861).on("pointerdown",()=>{this.cameras.main.fadeOut(500,255,255,255),this.time.delayedCall(500,()=>{const f=Math.max(0,e.score-100*e.level);this.scene.start("GamePlay",{level:e.level,score:f})})}),this.createIceButton(t/2+120,n,"메인 메뉴",6600182).on("pointerdown",()=>{this.cameras.main.fadeOut(500,255,255,255),this.time.delayedCall(500,()=>{this.scene.start("MainMenu")})}),this.createIceCrystals()}createBackground(){const{width:e,height:t}=this.cameras.main;for(let s=0;s<10;s++){const r=t/10*s,a=o.Display.Color.Interpolate.ColorWithColor(o.Display.Color.ValueToColor(h.COLORS.BACKGROUND_TOP),o.Display.Color.ValueToColor(h.COLORS.BACKGROUND_BOTTOM),10,s);this.add.rectangle(e/2,r+t/20,e,t/10,o.Display.Color.GetColor(a.r,a.g,a.b)).setDepth(-10)}}createSnowEffect(){const{width:e,height:t}=this.cameras.main;for(let s=0;s<100;s++){const r=o.Math.Between(0,e),a=o.Math.Between(-t,t),i=o.Math.Between(2,5),l=o.Math.Between(h.PARTICLES.SNOW_SPEED.min,h.PARTICLES.SNOW_SPEED.max),n=this.add.rectangle(r,a,i,i,16777215,.7);n.setDepth(-5),this.tweens.add({targets:n,y:t+10,x:r+o.Math.Between(-40,40),duration:(t-a)*(100/l),repeat:-1,onRepeat:()=>{n.x=o.Math.Between(0,e),n.y=-10}}),i>3&&this.tweens.add({targets:n,angle:360,duration:o.Math.Between(4e3,8e3),repeat:-1}),this.snowParticles.push(n)}}createIceButton(e,t,s,r){const l=this.add.graphics(),n=(f,g=!1)=>{l.clear(),l.fillStyle(f,g?.95:.85),l.fillRoundedRect(e-200/2,t-60/2,200,60,12),l.lineStyle(2,16777215,.9),l.strokeRoundedRect(e-200/2,t-60/2,200,60,12),g&&(l.fillStyle(16777215,.2),l.fillRoundedRect(e-200/2+4,t-60/2+4,200-8,60/3,8))};n(r);const d=this.add.text(e,t,s,{fontSize:"28px",color:"#ffffff",fontStyle:"bold"});d.setOrigin(.5);const u=this.add.zone(e,t,200,60);return u.setInteractive({useHandCursor:!0}),u.on("pointerover",()=>{n(r,!0),this.tweens.add({targets:[d,l],scaleX:1.05,scaleY:1.05,duration:100})}),u.on("pointerout",()=>{n(r,!1),this.tweens.add({targets:[d,l],scaleX:1,scaleY:1,duration:100})}),u}createIceCrystals(){const{width:e,height:t}=this.cameras.main;[{x:50,y:100},{x:e-50,y:100},{x:80,y:t-100},{x:e-80,y:t-100}].forEach((r,a)=>{const i=this.add.star(r.x,r.y,6,15,30,8900331);i.setAlpha(.3),i.setDepth(-2),this.tweens.add({targets:i,angle:360,duration:1e4+a*2e3,repeat:-1,ease:"Linear"}),this.tweens.add({targets:i,alpha:.6,scaleX:1.1,scaleY:1.1,duration:2e3+a*500,yoyo:!0,repeat:-1,ease:"Sine.inOut"})})}createSparkleCircle(e,t,s){for(let a=0;a<8;a++){const i=a/8*Math.PI*2,l=e+Math.cos(i)*s,n=t+Math.sin(i)*s,d=this.add.star(l,n,4,3,8,16777215);d.setAlpha(0),this.tweens.add({targets:d,alpha:1,scaleX:1.5,scaleY:1.5,duration:400,yoyo:!0,onComplete:()=>{d.destroy()}})}}}const w=document.querySelector("#app");w&&(w.innerHTML=`
    <div style="width: 100%; min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%); padding: 20px; box-sizing: border-box;">
      <div style="background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border-radius: 20px; padding: 30px; box-shadow: 0 8px 32px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);">
        <div id="game-container" style="border-radius: 15px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.5);"></div>
        <div style="margin-top: 20px; color: rgba(255,255,255,0.9); text-align: center;">
          <p style="font-size: 16px; margin: 0; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">❄️ 방향키: 이동 • 스페이스바: 점프 • 경로 노출 시 스페이스바: 즉시 시작 ❄️</p>
        </div>
      </div>
    </div>
  `);window.addEventListener("DOMContentLoaded",()=>{const y={type:o.AUTO,width:800,height:600,parent:"game-container",backgroundColor:"#1a1a2e",scale:{mode:o.Scale.NONE,autoCenter:o.Scale.NO_CENTER},scene:[P,M,B,O]};new o.Game(y)});
